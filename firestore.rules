service cloud.firestore {
	match /databases/{database}/documents {
    	function isSignedIn() {
    		return request.auth != null;
    	}
      function getDoc(id, col) {
        return get(/databases/$(database)/documents/$(col)/$(id))
      }

      function docExists(id, col) {
      	return exists(/databases/$(database)/documents/$(col)/$(id))
      }

      function data() {
        return request.resource.data;
      }

    	match /delivery/{deliveryId} {
    		allow read: if true;

    		allow create, update:
  				if request.resource.keys().hasAll(['timetamp, driver, banjar'])
  				//driver exists and his role is employee
  				&& getDoc(data().driver.id, 'person').data.type.employee == true
  				//timestamp
  				&& (data().timestamp) is timestamp
  				//banjar exists
  				&& docExists(data().banjar.id, 'banjar')
      }
  	}
  }
}
